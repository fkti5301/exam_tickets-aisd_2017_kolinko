# Вопрос 49: Контейнеры - хэш-таблицы
---
Хэш-таблица - обобщение способа хранения множества целых чисел (ключей) в форме вектора битов на случай, когда мощность универсума _U_ очень велика по отношению к мощности множеств, с которыми нужно работать. Функция отображения преобразует значения ключей к интервалу [0, m-1], где _m_ - размер хэш-таблицы, _m_ << |_U_|. В хэш-таблице хранятся значения ключей и имеется возможность размещения в ней более одного ключа для каждого значения функции отображения (разрешать коллизии).
Условия уменьшения возможности коллизий:
* Размер хэш-таблицы с запасом. Если размер таблицы превышает мощность хранимого множества более чем вдвое, вероятность коллизии становится меньше 0.5. Если размер множества заранее не известен, то выбирают начальный размер, а затем таблицу перестраивают с увеличением размера (обычно вдвое).
* Подобрать функцию отображения (хэш-функцию) такую, чтобы все ячейки таблицы были востребованы с равной вероятностью.

По способу разрешения коллизий различают хэш-таблицы двух типов:
1. С открытой адресацией. Конфликтующие значения ключей размещаются в свободных ячейках таблицы.
2. С цепочками переполнения. Каждая ячейка таблицы содержит указатель на список конфликтующих ключей.

В первой таблице все элементы хранятся непосредственно в хэш-таблице, без использования связанных списков. При переполнении таблицы применяется динамическое увеличение размера таблицы. Для разрешени коллизий применяются несколько подходов. Самый простой - метод линейного исследования: в случае коллизии проверяются все ячейки одна за другой, пока не найдётся пустая ячейка (при достижении конца таблицы, поиск продолжается с начала таблицы). Главная проблема - кластеризация (длинная последовательность занятых ячеек).
![hash1](/resources/imgs/t49_1.jpg)

Во второй таблице, объединённые элементы, хэшированные в одну ячейку, формируют связный список. Процедура вставки в худшем случае выполнится за _O(1)_. Время поиска зависит от длины списка, и в худшем случае равно _O(n)_, при условии, что всё хэшируется в одну ячейку. Если функция распределит _n_ ключей по _m_ ячейкам равномерно, то в каждом списке будет содержаться порядка _n/m_ ключей. Это число называется коэффициентом заполнения. В среднем случае все операции в такой таблице выполняются за время _O(1)_.
![hash1](/resources/imgs/t49_2.jpg)

Таблица второго типа применяестя чаще, потому что для них не существует проблемы переполнения. При слишком большой мощности хранимого множества таблица работает как _m_ списков.
В хэш-таблице можно хранить и множество с повторениями: совпадающие значения ключей не создают никаких проблем, кроме коллизий, которые решаются обычным образом.
Худший случай оценки времени: _O(n)_ - для поиска и удаления элемента, _O(n^2)_ - для двуместной операции над множествами.
Если ключи - целые числа, то хорошие результаты можно получить с хэш-функцией вида:
_h(x) = (a * x + b) % m_
где _m_ - таблицы, а _a_ и _b_ - простые числа.
Обычно _a_ выбирается близким по значению к _m_, а _b_ - к 1. Так, при _m_ = 100 можно взять _a_ = 97, _b_ = 11. Такой выбор обеспечивает равномерное использование всех ячеек в большинстве практичесикх случаев.